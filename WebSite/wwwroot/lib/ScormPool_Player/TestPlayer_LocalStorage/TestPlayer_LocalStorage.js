
Type.createNamespace('TestPlayer_LocalStorage');TestPlayer_LocalStorage.TestUtils=function(){}
TestPlayer_LocalStorage.TestUtils.parseXML=function(markup){return XMLDocumentParser.parse(markup);}
TestPlayer_LocalStorage.TestUtils.cleanHtml=function(){var $0=document.getElementById('contentIFrame');var $1=document.getElementById('treeContainer');var $2=document.getElementById('navigationContainer');if(!isNullOrUndefined($0)){document.body.removeChild($0);}if(!isNullOrUndefined($1)){document.body.removeChild($1);}if(!isNullOrUndefined($2)){document.body.removeChild($2);}}
TestPlayer_LocalStorage.TestPlayerLocalStorage=function(){this.$1_0=new LocalStorage.Storage();this.$1_4=TestPlayer_LocalStorage.TestUtils.parseXML('<manifest '+TestPlayer_LocalStorage.TestPlayerLocalStorage.$1_1+'>'+'<metadata><schemaversion>1.2</schemaversion></metadata>\r\n    <organizations>\r\n        <organization identifier=\"Test1\">\r\n            <title>Organization</title>\r\n            <item identifier=\"item_1\">\r\n                <title>Item 1</title>\r\n                <item identifier=\"item_1_1\" identifierref=\"ref_item_1_1\">\r\n                    <title>Item 1_1</title>\r\n                </item>\r\n                <item identifier=\"item_1_2\" identifierref=\"ref_item_1_2\">\r\n                    <title>Item 1_2</title>\r\n                </item>\r\n            </item>\r\n            <item identifier=\"item_2\">\r\n                <title>Item 2</title>\r\n                <item identifier=\"item_2_1\" identifierref=\"ref_item_2_1\">\r\n                    <title>Item 2_1</title>\r\n                </item>\r\n                <item identifier=\"item_2_2\">\r\n                    <title>Item 2_2</title>\r\n                    <item identifier=\"item_2_2_1\" identifierref=\"ref_item_2_2_1\">\r\n                        <title>Item 2_2_1</title>\r\n                    </item>\r\n                </item>\r\n                <item identifier=\"item_2_3\" identifierref=\"ref_item_2_3\">\r\n                    <title>Item 2_3</title>\r\n                </item>\r\n            </item>\r\n        </organization>\r\n    </organizations>\r\n    <resources>\r\n      <resource identifier=\"ref_item_1_1\" type=\"webcontent\" adlcp:scormtype=\"sco\" href=\"page.html\"/>\r\n      <resource identifier=\"ref_item_1_2\" type=\"webcontent\" adlcp:scormtype=\"sco\" href=\"page.html\"/>\r\n      <resource identifier=\"ref_item_2_1\" type=\"webcontent\" adlcp:scormtype=\"sco\" href=\"page.html\"/>\r\n      <resource identifier=\"ref_item_2_2_1\" type=\"webcontent\" adlcp:scormtype=\"sco\" href=\"page.html\"/>\r\n      <resource identifier=\"ref_item_2_3\" type=\"webcontent\" adlcp:scormtype=\"sco\" href=\"page.html\"/>\r\n    </resources>\r\n</manifest>');this.$1_5=TestPlayer_LocalStorage.TestUtils.parseXML(TestPlayer_LocalStorage.TestPlayerLocalStorage.$1_3+'<organizations default = \"SX-04a\">\r\n      <organization identifier = \"SX-04a\" adlcp:sharedDataGlobalToSystem=\"true\">\r\n         <title>LMS Test Content Package SX-04a</title>\r\n         <item identifier = \"activity_1\" identifierref = \"SEQ01\" parameters = \"?tc=SX-04a&amp;act=1\">\r\n            <title>Activity 1</title>\r\n            <adlnav:presentation>\r\n               <adlnav:navigationInterface>\r\n                  <adlnav:hideLMSUI>continue</adlnav:hideLMSUI>\r\n                  <adlnav:hideLMSUI>previous</adlnav:hideLMSUI>\r\n                  <adlnav:hideLMSUI>suspendAll</adlnav:hideLMSUI>\r\n               </adlnav:navigationInterface>\r\n            </adlnav:presentation>\r\n\t\t\t<imsss:sequencing>\r\n               <imsss:sequencingRules>\r\n                  <imsss:preConditionRule>\r\n                     <imsss:ruleConditions>\r\n                        <imsss:ruleCondition condition = \"satisfied\"/>\r\n                     </imsss:ruleConditions>\r\n                     <imsss:ruleAction action = \"skip\"/>\r\n                  </imsss:preConditionRule>\r\n               </imsss:sequencingRules>\r\n               <imsss:objectives>\r\n                  <imsss:primaryObjective objectiveID = \"PRIMARYOBJ\">\r\n                     <imsss:mapInfo targetObjectiveID = \"gObj-SX04a\" writeSatisfiedStatus = \"true\" />\r\n                  </imsss:primaryObjective>\r\n               </imsss:objectives>\r\n            </imsss:sequencing>\r\n            <adlcp:data>\r\n                <adlcp:map targetID = \"dataMap1\"/>\r\n                <adlcp:map targetID = \"dataMap2\"/>\r\n            </adlcp:data>\r\n         </item>\r\n         <item identifier = \"activity_2\" identifierref = \"SEQ01\" parameters = \"?tc=SX-04a&amp;act=2\">\r\n            <title>Activity 2</title>\r\n\t\t\t<adlnav:presentation>\r\n               <adlnav:navigationInterface>\r\n                  <adlnav:hideLMSUI>continue</adlnav:hideLMSUI>\r\n                  <adlnav:hideLMSUI>previous</adlnav:hideLMSUI>\r\n                  <adlnav:hideLMSUI>suspendAll</adlnav:hideLMSUI>\r\n               </adlnav:navigationInterface>\r\n            </adlnav:presentation>\r\n            <imsss:sequencing>\r\n               <imsss:objectives>\r\n                  <imsss:primaryObjective objectiveID = \"PRIMARYOBJ\">\r\n                     <imsss:mapInfo targetObjectiveID = \"gObj-SX04a\" writeSatisfiedStatus = \"true\" />\r\n                  </imsss:primaryObjective>\r\n               </imsss:objectives>\r\n            </imsss:sequencing>\r\n            <adlcp:data>\r\n                <adlcp:map targetID = \"dataMap3\"/>\r\n                <adlcp:map targetID = \"dataMap4\" writeSharedData = \"false\" readSharedData = \"false\"/>\r\n            </adlcp:data>\r\n         </item>\r\n         <item identifier = \"activity_3\" identifierref = \"SEQ01\" parameters = \"?tc=SX-04a&amp;act=3\">\r\n            <title>Activity 3</title>\r\n\t\t\t<adlnav:presentation>\r\n               <adlnav:navigationInterface>\r\n                  <adlnav:hideLMSUI>continue</adlnav:hideLMSUI>\r\n                  <adlnav:hideLMSUI>previous</adlnav:hideLMSUI>\r\n                  <adlnav:hideLMSUI>suspendAll</adlnav:hideLMSUI>\r\n               </adlnav:navigationInterface>\r\n            </adlnav:presentation>\r\n         </item>\r\n         <imsss:sequencing>\r\n            <imsss:controlMode choice = \"false\" flow = \"true\"/>\r\n         </imsss:sequencing>\r\n      </organization>\r\n   </organizations>\r\n   <resources>\r\n      <resource identifier=\"SEQ01\" type=\"webcontent\" adlcp:scormType=\"sco\" href=\"page.html\"/>\r\n   </resources>\r\n</manifest>');this.$1_6=TestPlayer_LocalStorage.TestUtils.parseXML(TestPlayer_LocalStorage.TestPlayerLocalStorage.$1_3+'<organizations default = \"SX-04a\">\r\n      <organization identifier = \"SX-04a\" adlseq:objectivesGlobalToSystem = \"false\" adlcp:sharedDataGlobalToSystem=\"false\">\r\n         <title>LMS Test Content Package SX-04a</title>\r\n         <item identifier = \"activity_1\" identifierref = \"SEQ01\" parameters = \"?tc=SX-04a&amp;act=1\">\r\n            <title>Activity 1</title>\r\n            <adlnav:presentation>\r\n               <adlnav:navigationInterface>\r\n                  <adlnav:hideLMSUI>continue</adlnav:hideLMSUI>\r\n                  <adlnav:hideLMSUI>previous</adlnav:hideLMSUI>\r\n                  <adlnav:hideLMSUI>suspendAll</adlnav:hideLMSUI>\r\n               </adlnav:navigationInterface>\r\n            </adlnav:presentation>\r\n\t\t\t<imsss:sequencing>\r\n               <imsss:sequencingRules>\r\n                  <imsss:preConditionRule>\r\n                     <imsss:ruleConditions>\r\n                        <imsss:ruleCondition condition = \"satisfied\"/>\r\n                     </imsss:ruleConditions>\r\n                     <imsss:ruleAction action = \"skip\"/>\r\n                  </imsss:preConditionRule>\r\n               </imsss:sequencingRules>\r\n               <imsss:objectives>\r\n                  <imsss:primaryObjective objectiveID = \"PRIMARYOBJ\">\r\n                     <imsss:mapInfo targetObjectiveID = \"gObj-SX04a\" writeSatisfiedStatus = \"true\" />\r\n                  </imsss:primaryObjective>\r\n               </imsss:objectives>\r\n            </imsss:sequencing>\r\n            <adlcp:data>\r\n                <adlcp:map targetID = \"dataMap1\"/>\r\n                <adlcp:map targetID = \"dataMap2\"/>\r\n            </adlcp:data>\r\n         </item>\r\n         <item identifier = \"activity_2\" identifierref = \"SEQ01\" parameters = \"?tc=SX-04a&amp;act=2\">\r\n            <title>Activity 2</title>\r\n\t\t\t<adlnav:presentation>\r\n               <adlnav:navigationInterface>\r\n                  <adlnav:hideLMSUI>continue</adlnav:hideLMSUI>\r\n                  <adlnav:hideLMSUI>previous</adlnav:hideLMSUI>\r\n                  <adlnav:hideLMSUI>suspendAll</adlnav:hideLMSUI>\r\n               </adlnav:navigationInterface>\r\n            </adlnav:presentation>\r\n            <imsss:sequencing>\r\n               <imsss:objectives>\r\n                  <imsss:primaryObjective objectiveID = \"PRIMARYOBJ\">\r\n                     <imsss:mapInfo targetObjectiveID = \"gObj-SX04a\" writeSatisfiedStatus = \"true\" />\r\n                  </imsss:primaryObjective>\r\n               </imsss:objectives>\r\n            </imsss:sequencing>\r\n            <adlcp:data>\r\n                <adlcp:map targetID = \"dataMap3\"/>\r\n                <adlcp:map targetID = \"dataMap4\" writeSharedData = \"false\" readSharedData = \"false\"/>\r\n            </adlcp:data>\r\n         </item>\r\n         <item identifier = \"activity_3\" identifierref = \"SEQ01\" parameters = \"?tc=SX-04a&amp;act=3\">\r\n            <title>Activity 3</title>\r\n\t\t\t<adlnav:presentation>\r\n               <adlnav:navigationInterface>\r\n                  <adlnav:hideLMSUI>continue</adlnav:hideLMSUI>\r\n                  <adlnav:hideLMSUI>previous</adlnav:hideLMSUI>\r\n                  <adlnav:hideLMSUI>suspendAll</adlnav:hideLMSUI>\r\n               </adlnav:navigationInterface>\r\n            </adlnav:presentation>\r\n         </item>\r\n         <imsss:sequencing>\r\n            <imsss:controlMode choice = \"false\" flow = \"true\"/>\r\n         </imsss:sequencing>\r\n      </organization>\r\n   </organizations>\r\n   <resources>\r\n      <resource identifier=\"SEQ01\" type=\"webcontent\" adlcp:scormType=\"sco\" href=\"page.html\"/>\r\n   </resources>\r\n</manifest>');TestPlayer_LocalStorage.TestPlayerLocalStorage.constructBase(this);}
TestPlayer_LocalStorage.TestPlayerLocalStorage.prototype={setup:function(){if(this.$1_0.isSupported()){this.$1_0.clear();}},teardown:function(){if(this.$1_0.isSupported()){this.$1_0.clear();}TestPlayer_LocalStorage.TestUtils.cleanHtml();},tests:function(){test('SCORM 1.2 storage',Delegate.create(this,function(){
var $1_0=new Player.ContentPlayer(null,this.$1_4,true,false,false);ok($1_0.getSCORMVersion()===1,'Correct. SCORM version 1.2');var $1_1=$1_0.getActivityTree_V12();ok(!isNullOrUndefined($1_1),'ActivityTree for SCORM 1.2 exists');ok(!isNullOrUndefined($1_1.getOrganization()),'Default organization is not empty');ok($1_1.getOrganization().getIdentifier()==='Test1','Default organization identifier \'Test1\'');ok($1_1.getChildrensCount()===1,'Only one organization available');var $1_2=$1_1.getActiveAPI();ok(!isNullOrUndefined($1_2),'ActivityTree active API exists');equals($1_2.getActivityTreeNode().getIdentifier(),'item_1_1','Correct item identifier');ok(!$1_2.isInitAttempted(),'API is not initialized yet, we are using empty page.html file');var $1_3=$1_2.LMSInitialize('');equals($1_3,'true','Function must complete successfully');equals($1_2.LMSGetLastError(),'0','LMSInitialize shall set the API Error Code to \'0\' (No error) if it completes successfully');equals($1_2.getActivityTreeNode().getLessonstatus(),'not attempted','Correct \'not attempted\' status');equals($1_2.LMSGetValue('cmi.core.entry'),'ab-initio','First time intering SCO');$1_3=$1_2.LMSSetValue('cmi.suspend_data','s1');equals($1_3,'true','Set value ok');$1_3=$1_2.LMSFinish('');equals($1_3,'true','Finished successfully');equals($1_2.LMSGetLastError(),'0','Shall set the API Error Code to \'0\' (No error) if it completes successfully');equals($1_2.getActivityTreeNode().getLessonstatus(),'completed','Correct \'completed\' status');TestPlayer_LocalStorage.TestUtils.cleanHtml();$1_0=new Player.ContentPlayer(null,this.$1_4,true,false,false);$1_1=$1_0.getActivityTree_V12();ok($1_1.getOrganization().getIdentifier()==='Test1','Default organization identifier \'Test1\'');$1_2=$1_1.getActiveAPI();equals($1_2.getActivityTreeNode().getIdentifier(),'item_1_2','Correct item identifier');ok(!$1_2.isInitAttempted(),'API is not initialized yet, we are using empty page.html file');$1_3=$1_2.LMSInitialize('');equals($1_3,'true','Function must complete successfully');equals($1_2.LMSGetLastError(),'0','LMSInitialize shall set the API Error Code to \'0\' (No error) if it completes successfully');equals($1_2.getActivityTreeNode().getLessonstatus(),'not attempted','Correct \'not attempted\' status');$1_3=$1_2.LMSSetValue('cmi.core.lesson_location','a1');equals($1_3,'true','Set value ok');$1_3=$1_2.LMSSetValue('cmi.suspend_data','s1');equals($1_3,'true','Set value ok');equals($1_1.getStoredStatuses()['item_1_1'],'completed','Correct stored statuse for item_1_1');var $1_4=$1_2.getActivityTreeNode().getPrevNode();equals($1_4.getIdentifier(),'item_1_1','Correct item identifier');equals($1_4.getLessonstatus(),'completed','Correct \'completed\' status');TestPlayer_LocalStorage.TestUtils.cleanHtml();$1_0=new Player.ContentPlayer(null,this.$1_4,true,false,false);$1_1=$1_0.getActivityTree_V12();$1_2=$1_1.getActiveAPI();equals($1_2.getActivityTreeNode().getIdentifier(),'item_1_2','Correct item identifier');equals($1_2.getActivityTreeNode().getLessonstatus(),'not attempted','Correct \'not attempted\' status');$1_3=$1_2.LMSInitialize('');equals($1_3,'true','Function must complete successfully');equals($1_2.LMSGetLastError(),'0','LMSInitialize shall set the API Error Code to \'0\' (No error) if it completes successfully');$1_3=$1_2.LMSGetValue('cmi.core.lesson_location');equals($1_3,'','Correct lesson location');$1_3=$1_2.LMSGetValue('cmi.suspend_data');equals($1_3,'','Correct suspend_data');$1_3=$1_2.LMSSetValue('cmi.core.lesson_status','completed');equals($1_3,'true','Set value ok');$1_3=$1_2.LMSCommit('');equals($1_3,'true','Completes successfully');equals($1_2.LMSGetLastError(),'0','Shall set the API Error Code to \'0\' (No error) if it completes successfully');$1_3=$1_2.LMSFinish('');equals($1_3,'true','Finished successfully');equals($1_2.LMSGetLastError(),'0','Shall set the API Error Code to \'0\' (No error) if it completes successfully');equals($1_2.getActivityTreeNode().getLessonstatus(),'completed','Correct \'completed\' status');TestPlayer_LocalStorage.TestUtils.cleanHtml();$1_0=new Player.ContentPlayer(null,this.$1_4,true,false,false);$1_1=$1_0.getActivityTree_V12();$1_2=$1_1.getActiveAPI();equals($1_2.getActivityTreeNode().getIdentifier(),'item_2_1','Correct item identifier');equals($1_2.getActivityTreeNode().getLessonstatus(),'not attempted','Correct \'not attempted\' status');$1_3=$1_2.LMSInitialize('');equals($1_3,'true','Function must complete successfully');equals($1_2.LMSGetValue('cmi.core.entry'),'ab-initio','First time intering SCO');$1_3=$1_2.LMSSetValue('cmi.core.lesson_location','p1');equals($1_3,'true','Set value ok');$1_3=$1_2.LMSSetValue('cmi.suspend_data','s0');equals($1_3,'true','Set value ok');$1_3=$1_2.LMSSetValue('cmi.core.exit','suspend');equals($1_3,'true','Set value ok');$1_3=$1_2.LMSFinish('');equals($1_3,'true','Finished successfully');TestPlayer_LocalStorage.TestUtils.cleanHtml();$1_0=new Player.ContentPlayer(null,this.$1_4,true,false,false);$1_1=$1_0.getActivityTree_V12();ok($1_1.getOrganization().getIdentifier()==='Test1','Default organization identifier \'Test1\'');$1_2=$1_1.getActiveAPI();equals($1_2.getActivityTreeNode().getIdentifier(),'item_2_1','Correct item identifier');equals($1_2.getActivityTreeNode().getLessonstatus(),'not attempted','Correct \'not attempted\' status');$1_3=$1_2.LMSInitialize('');equals($1_3,'true','Function must complete successfully');equals($1_2.LMSGetValue('cmi.core.entry'),'resume','Resume previously visited SCO');$1_3=$1_2.LMSGetValue('cmi.core.exit');equals($1_3,'','cmi.core.exit');$1_3=$1_2.LMSGetValue('cmi.suspend_data');equals($1_3,'s0','Correct suspend_data');$1_3=$1_2.LMSSetValue('cmi.suspend_data','s1');equals($1_3,'true','Set value ok');$1_3=$1_2.LMSSetValue('cmi.core.lesson_status','incomplete');equals($1_3,'true','Set value ok');$1_3=$1_2.LMSFinish('');equals($1_3,'true','Finished successfully');equals($1_2.getActivityTreeNode().getLessonstatus(),'incomplete','Correct \'not attempted\' status');TestPlayer_LocalStorage.TestUtils.cleanHtml();$1_0=new Player.ContentPlayer(null,this.$1_4,true,false,false);$1_1=$1_0.getActivityTree_V12();ok($1_1.getOrganization().getIdentifier()==='Test1','Default organization identifier \'Test1\'');$1_2=$1_1.getActiveAPI();equals($1_2.getActivityTreeNode().getIdentifier(),'item_2_1','Correct item identifier');$1_3=$1_2.LMSInitialize('');equals($1_3,'true','Function must complete successfully');$1_3=$1_2.LMSGetValue('cmi.core.lesson_location');equals($1_3,'','Correct lesson location');$1_3=$1_2.LMSGetValue('cmi.suspend_data');equals($1_3,'s1','Correct suspend_data');}));test('1. SCORM 2004 storage (Objectives global to System)',Delegate.create(this,function(){
var $1_0=new Player.ContentPlayer(null,this.$1_5,true,false,false);ok($1_0.getSCORMVersion()===2,'Correct. SCORM version 2004');var $1_1=$1_0.getActivityTree_V13();equals($1_1.getActiveAPI().getActivityTreeNode().getIdentifier(),'activity_1','* Identify Activity 1 for delivery');ok($1_1.isObjectivesglobaltoSystem(),'Objectives global to system (by default)');var $1_2=$1_1.getActiveAPI();ok(!isNullOrUndefined($1_2),'ActivityTree active API exists');ok(!$1_2.isInitAttempted(),'API is not initialized yet, we are using empty page.html file');var $1_3=$1_2.Initialize('');equals($1_3,'true','Function must complete successfully');equals($1_2.GetLastError(),'0','LMSInitialize shall set the API Error Code to \'0\' (No error) if it completes successfully');equals($1_2.GetValue('cmi.entry'),'ab-initio','First time intering SCO');equals($1_2.GetValue('cmi.success_status'),'unknown','Correct cmi.success_status');$1_3=$1_2.SetValue('cmi.success_status','passed');equals($1_3,'true','* cmi.success_status accepted');var $1_4=$1_1.getGlobalObjectives()['gObj-SX04a'];ok(!$1_4.satisfiedStatus,'Global objective not satisfied yet');$1_3=$1_2.SetValue('cmi.location','p1');equals($1_3,'true','* cmi.location accepted');$1_1.getActiveAPI().Terminate('');TestPlayer_LocalStorage.TestUtils.cleanHtml();$1_0=new Player.ContentPlayer(null,this.$1_5,true,false,false);$1_1=$1_0.getActivityTree_V13();equals($1_1.getActiveAPI().getActivityTreeNode().getIdentifier(),'activity_2','* Identify Activity 2 for delivery');$1_2=$1_1.getActiveAPI();$1_4=$1_1.getGlobalObjectives()['gObj-SX04a'];ok($1_4.satisfiedStatus,'Global objective satisfied');ok(!$1_2.isInitAttempted(),'API is not initialized yet, we are using empty page.html file');$1_3=$1_2.Initialize('');equals($1_3,'true','Function must complete successfully');equals($1_2.GetLastError(),'0','LMSInitialize shall set the API Error Code to \'0\' (No error) if it completes successfully');equals($1_2.GetValue('cmi.entry'),'ab-initio','First time intering SCO');equals($1_2.GetValue('cmi.success_status'),'unknown','Correct cmi.success_status');$1_3=$1_2.SetValue('cmi.success_status','failed');equals($1_3,'true','* cmi.success_status accepted');$1_4=$1_1.getGlobalObjectives()['gObj-SX04a'];ok($1_4.satisfiedStatus,'Global objective satisfied');$1_1.getActiveAPI().Terminate('');TestPlayer_LocalStorage.TestUtils.cleanHtml();$1_0=new Player.ContentPlayer(null,this.$1_5,true,false,false);$1_1=$1_0.getActivityTree_V13();equals($1_1.getActiveAPI().getActivityTreeNode().getIdentifier(),'activity_1','* Identify Activity 1 for delivery');$1_2=$1_1.getActiveAPI();$1_4=$1_1.getGlobalObjectives()['gObj-SX04a'];ok(!$1_4.satisfiedStatus,'Global objective not satisfied');ok(!$1_2.isInitAttempted(),'API is not initialized yet, we are using empty page.html file');$1_3=$1_2.Initialize('');equals($1_3,'true','Function must complete successfully');equals($1_2.GetLastError(),'0','LMSInitialize shall set the API Error Code to \'0\' (No error) if it completes successfully');equals($1_2.GetValue('cmi.entry'),'','---- Second time intering SCO');equals($1_2.GetValue('cmi.exit'),'','Empty cmi.exit');equals($1_2.GetValue('cmi.location'),'','Correct location');equals($1_2.GetValue('cmi.success_status'),'unknown','Correct cmi.success_status');$1_3=$1_2.SetValue('cmi.suspend_data','s1');equals($1_3,'true','Set value ok');$1_3=$1_2.SetValue('cmi.location','p1');equals($1_3,'true','* cmi.location accepted');$1_1.getActiveAPI().Terminate('');TestPlayer_LocalStorage.TestUtils.cleanHtml();$1_0=new Player.ContentPlayer(null,this.$1_5,true,false,false);$1_1=$1_0.getActivityTree_V13();equals($1_1.getActiveAPI().getActivityTreeNode().getIdentifier(),'activity_1','* Identify Activity 2 for delivery');$1_2=$1_1.getActiveAPI();$1_4=$1_1.getGlobalObjectives()['gObj-SX04a'];ok(!$1_4.satisfiedStatus,'Global objective not satisfied');ok(!$1_2.isInitAttempted(),'API is not initialized yet, we are using empty page.html file');$1_3=$1_2.Initialize('');equals($1_3,'true','Function must complete successfully');equals($1_2.GetLastError(),'0','LMSInitialize shall set the API Error Code to \'0\' (No error) if it completes successfully');equals($1_2.GetValue('cmi.success_status'),'unknown','Correct cmi.success_status');$1_3=$1_2.GetValue('cmi.suspend_data');equals($1_3,'s1','Correct suspend_data');equals($1_2.GetValue('cmi.location'),'','Correct location');$1_3=$1_2.SetValue('cmi.success_status','passed');equals($1_3,'true','* cmi.success_status accepted');$1_3=$1_2.SetValue('cmi.exit','suspend');equals($1_3,'true','* cmi.exit accepted');ok(isNullOrUndefined($1_1.savedSuspendedActivity),'We dont have suspended activity');$1_2.Terminate('');ok(!isNullOrUndefined($1_1.savedSuspendedActivity),'We have suspended activity');TestPlayer_LocalStorage.TestUtils.cleanHtml();$1_0=new Player.ContentPlayer(null,this.$1_5,true,false,false);$1_1=$1_0.getActivityTree_V13();equals($1_1.getActiveAPI().getActivityTreeNode().getIdentifier(),'activity_2','* Identify Activity 2 for delivery');ok(isNullOrUndefined($1_1.savedSuspendedActivity),'We dont have suspended activity');$1_2=$1_1.getActiveAPI();$1_4=$1_1.getGlobalObjectives()['gObj-SX04a'];ok($1_4.satisfiedStatus,'Global objective satisfied');ok(!$1_2.isInitAttempted(),'API is not initialized yet, we are using empty page.html file');$1_3=$1_2.Initialize('');equals($1_3,'true','Function must complete successfully');equals($1_2.GetLastError(),'0','LMSInitialize shall set the API Error Code to \'0\' (No error) if it completes successfully');$1_3=$1_2.GetValue('cmi.exit');equals($1_3,'','cmi.exit');$1_3=$1_2.SetValue('cmi.success_status','failed');equals($1_3,'true','* cmi.success_status accepted');$1_2.Terminate('');TestPlayer_LocalStorage.TestUtils.cleanHtml();$1_0=new Player.ContentPlayer(null,this.$1_5,true,false,false);$1_1=$1_0.getActivityTree_V13();equals($1_1.getActiveAPI().getActivityTreeNode().getIdentifier(),'activity_1','* Identify Activity 2 for delivery');$1_2=$1_1.getActiveAPI();$1_4=$1_1.getGlobalObjectives()['gObj-SX04a'];ok(!$1_4.satisfiedStatus,'Global objective not satisfied');$1_3=$1_2.Initialize('');equals($1_3,'true','Function must complete successfully');$1_3=$1_2.GetValue('cmi.suspend_data');equals($1_3,'s1','Correct suspend_data');equals($1_2.GetValue('cmi.location'),'','Correct location');equals($1_2.GetValue('cmi.success_status'),'passed','cmi.success_status');}));test('2. SCORM 2004 storage (Objectives NOT global to System)',Delegate.create(this,function(){
var $1_0=new Player.ContentPlayer(null,this.$1_6,true,false,false);ok($1_0.getSCORMVersion()===2,'Correct. SCORM version 2004');var $1_1=$1_0.getActivityTree_V13();equals($1_1.getActiveAPI().getActivityTreeNode().getIdentifier(),'activity_1','* Identify Activity 1 for delivery');ok(!$1_1.isObjectivesglobaltoSystem(),'Objectives is NOT global to system');var $1_2=$1_1.getActiveAPI();ok(!isNullOrUndefined($1_2),'ActivityTree active API exists');ok(!$1_2.isInitAttempted(),'API is not initialized yet, we are using empty page.html file');var $1_3=$1_2.Initialize('');equals($1_3,'true','Function must complete successfully');equals($1_2.GetLastError(),'0','LMSInitialize shall set the API Error Code to \'0\' (No error) if it completes successfully');equals($1_2.GetValue('cmi.entry'),'ab-initio','First time intering SCO');equals($1_2.GetValue('cmi.success_status'),'unknown','Correct cmi.success_status');$1_3=$1_2.SetValue('cmi.success_status','passed');equals($1_3,'true','* cmi.success_status accepted');var $1_4=$1_1.getGlobalObjectives()['gObj-SX04a'];ok(!$1_4.satisfiedStatus,'Global objective not satisfied yet');$1_3=$1_2.SetValue('cmi.location','p1');equals($1_3,'true','* cmi.location accepted');$1_2.Terminate('');TestPlayer_LocalStorage.TestUtils.cleanHtml();$1_0=new Player.ContentPlayer(null,this.$1_6,true,false,false);$1_1=$1_0.getActivityTree_V13();equals($1_1.getActiveAPI().getActivityTreeNode().getIdentifier(),'activity_1','* Identify Activity 2 for delivery');$1_2=$1_1.getActiveAPI();$1_4=$1_1.getGlobalObjectives()['gObj-SX04a'];ok(!$1_4.satisfiedStatus,'Global objective not satisfied');ok(!$1_2.isInitAttempted(),'API is not initialized yet, we are using empty page.html file');$1_3=$1_2.Initialize('');equals($1_3,'true','Function must complete successfully');equals($1_2.GetLastError(),'0','LMSInitialize shall set the API Error Code to \'0\' (No error) if it completes successfully');equals($1_2.GetValue('cmi.entry'),'','Second time intering SCO');equals($1_2.GetValue('cmi.success_status'),'unknown','Correct cmi.success_status');$1_3=$1_2.SetValue('cmi.success_status','passed');equals($1_3,'true','* cmi.success_status accepted');$1_4=$1_1.getGlobalObjectives()['gObj-SX04a'];ok(!$1_4.satisfiedStatus,'Global objective not satisfied');$1_3=$1_2.SetValue('cmi.exit','suspend');equals($1_3,'true','* cmi.exit accepted');$1_2.Terminate('');TestPlayer_LocalStorage.TestUtils.cleanHtml();$1_0=new Player.ContentPlayer(null,this.$1_6,true,false,false);$1_1=$1_0.getActivityTree_V13();equals($1_1.getActiveAPI().getActivityTreeNode().getIdentifier(),'activity_2','* Identify Activity 2 for delivery');$1_2=$1_1.getActiveAPI();ok(!$1_2.isInitAttempted(),'API is not initialized yet, we are using empty page.html file');$1_3=$1_2.Initialize('');equals($1_3,'true','Function must complete successfully');equals($1_2.GetLastError(),'0','LMSInitialize shall set the API Error Code to \'0\' (No error) if it completes successfully');$1_4=$1_1.getGlobalObjectives()['gObj-SX04a'];ok($1_4.satisfiedStatus,'Global objective satisfied');}));test('3. SCORM 2004 storage (Shared data global to System)',Delegate.create(this,function(){
var $1_0=new Player.ContentPlayer(null,this.$1_5,true,false,false);ok($1_0.getSCORMVersion()===2,'Correct. SCORM version 2004');var $1_1=$1_0.getActivityTree_V13();equals($1_1.getActiveAPI().getActivityTreeNode().getIdentifier(),'activity_1','* Identify Activity 1 for delivery');ok($1_1.isShareddataglobaltosystem(),'Shared data global to system (by default)');var $1_2=$1_1.getActiveAPI();ok(!isNullOrUndefined($1_2),'ActivityTree active API exists');ok(!$1_2.isInitAttempted(),'API is not initialized yet, we are using empty page.html file');var $1_3=$1_2.Initialize('');equals($1_3,'true','Function must complete successfully');equals($1_2.GetLastError(),'0','LMSInitialize shall set the API Error Code to \'0\' (No error) if it completes successfully');$1_3=$1_2.GetValue('adl.data._count');equals($1_3,'4','Correct adl.data._count');$1_3=$1_2.SetValue('adl.data.0.store','value_0');equals($1_3,'true','adl.data.0.store accepted');$1_3=$1_2.SetValue('adl.data.1.store','value_1');equals($1_3,'true','adl.data.1.store accepted');$1_3=$1_2.SetValue('adl.data.2.store','value_2');equals($1_3,'true','adl.data.2.store accepted');$1_3=$1_2.GetValue('adl.data.3.store');equals($1_3,'','Empty adl.data.3.store');equals($1_2.GetLastError(),'405','Can\'t read value (protected in second SCO)');$1_3=$1_2.SetValue('adl.data.3.store','value_3');equals($1_3,'false','adl.data.3.store NOT accepted (protected in second SCO)');$1_3=$1_2.SetValue('cmi.success_status','passed');equals($1_3,'true','* cmi.success_status accepted');$1_1.getActiveAPI().Terminate('');TestPlayer_LocalStorage.TestUtils.cleanHtml();$1_0=new Player.ContentPlayer(null,this.$1_5,true,false,false);$1_1=$1_0.getActivityTree_V13();equals($1_1.getActiveAPI().getActivityTreeNode().getIdentifier(),'activity_2','* Identify Activity 2 for delivery');$1_2=$1_1.getActiveAPI();ok(!$1_2.isInitAttempted(),'API is not initialized yet, we are using empty page.html file');$1_3=$1_2.Initialize('');equals($1_3,'true','Function must complete successfully');equals($1_2.GetLastError(),'0','LMSInitialize shall set the API Error Code to \'0\' (No error) if it completes successfully');var $1_4=$1_1.getGlobalObjectives()['gObj-SX04a'];ok($1_4.satisfiedStatus,'Global objective satisfied');$1_3=$1_2.GetValue('adl.data._count');equals($1_3,'4','Correct adl.data._count');$1_3=$1_2.GetValue('adl.data.0.store');equals($1_3,'value_0','Correct adl.data.0.store');$1_3=$1_2.GetValue('adl.data.1.store');equals($1_3,'value_1','Correct adl.data.1.store');$1_3=$1_2.GetValue('adl.data.2.store');equals($1_3,'value_2','Correct adl.data.2.store');$1_3=$1_2.GetValue('adl.data.3.store');equals($1_3,'','Correct adl.data.3.store');$1_3=$1_2.SetValue('adl.data.3.store','value_3');equals($1_3,'true','adl.data.3.store accepted (NOT protected in second SCO)');$1_3=$1_2.GetValue('adl.data.3.store');equals($1_3,'value_3','Correct adl.data.3.store');$1_3=$1_2.SetValue('cmi.exit','suspend');equals($1_3,'true','* cmi.exit accepted');$1_1.getActiveAPI().Terminate('');TestPlayer_LocalStorage.TestUtils.cleanHtml();$1_0=new Player.ContentPlayer(null,this.$1_5,true,false,false);$1_1=$1_0.getActivityTree_V13();equals($1_1.getActiveAPI().getActivityTreeNode().getIdentifier(),'activity_2','* Identify Activity 2 for delivery');$1_2=$1_1.getActiveAPI();ok(!$1_2.isInitAttempted(),'API is not initialized yet, we are using empty page.html file');$1_3=$1_2.Initialize('');equals($1_3,'true','Function must complete successfully');equals($1_2.GetLastError(),'0','LMSInitialize shall set the API Error Code to \'0\' (No error) if it completes successfully');$1_4=$1_1.getGlobalObjectives()['gObj-SX04a'];ok($1_4.satisfiedStatus,'Global objective satisfied');$1_3=$1_2.GetValue('adl.data._count');equals($1_3,'4','Correct adl.data._count');$1_3=$1_2.GetValue('adl.data.0.store');equals($1_3,'value_0','Correct adl.data.0.store');$1_3=$1_2.GetValue('adl.data.3.store');equals($1_3,'value_3','Correct adl.data.3.store');}));test('4. SCORM 2004 storage (Shared data NOT global to System)',Delegate.create(this,function(){
var $1_0=new Player.ContentPlayer(null,this.$1_6,true,false,false);ok($1_0.getSCORMVersion()===2,'Correct. SCORM version 2004');var $1_1=$1_0.getActivityTree_V13();equals($1_1.getActiveAPI().getActivityTreeNode().getIdentifier(),'activity_1','* Identify Activity 1 for delivery');ok(!$1_1.isShareddataglobaltosystem(),'Shared data is NOT global to system');var $1_2=$1_1.getActiveAPI();ok(!isNullOrUndefined($1_2),'ActivityTree active API exists');ok(!$1_2.isInitAttempted(),'API is not initialized yet, we are using empty page.html file');var $1_3=$1_2.Initialize('');equals($1_3,'true','Function must complete successfully');equals($1_2.GetLastError(),'0','LMSInitialize shall set the API Error Code to \'0\' (No error) if it completes successfully');$1_3=$1_2.GetValue('adl.data._count');equals($1_3,'2','Correct adl.data._count');$1_3=$1_2.SetValue('adl.data.0.store','value_0');equals($1_3,'true','adl.data.0.store accepted');$1_3=$1_2.SetValue('adl.data.1.store','value_1');equals($1_3,'true','adl.data.1.store accepted');$1_3=$1_2.SetValue('cmi.success_status','passed');equals($1_3,'true','* cmi.success_status accepted');$1_3=$1_2.SetValue('cmi.exit','suspend');equals($1_3,'true','* cmi.exit accepted');$1_2.Terminate('');TestPlayer_LocalStorage.TestUtils.cleanHtml();$1_0=new Player.ContentPlayer(null,this.$1_6,true,false,false);$1_1=$1_0.getActivityTree_V13();equals($1_1.getActiveAPI().getActivityTreeNode().getIdentifier(),'activity_2','* Identify Activity 2 for delivery');$1_2=$1_1.getActiveAPI();ok(!$1_2.isInitAttempted(),'API is not initialized yet, we are using empty page.html file');$1_3=$1_2.Initialize('');equals($1_3,'true','Function must complete successfully');equals($1_2.GetLastError(),'0','LMSInitialize shall set the API Error Code to \'0\' (No error) if it completes successfully');$1_3=$1_2.GetValue('adl.data._count');equals($1_3,'2','Correct adl.data._count');$1_3=$1_2.GetValue('adl.data.0.store');equals($1_3,'','Correct adl.data.0.store');$1_3=$1_2.GetValue('adl.data.1.store');equals($1_3,'','Correct adl.data.1.store');$1_3=$1_2.SetValue('adl.data.0.store','value_2');equals($1_3,'true','adl.data.0.store accepted');$1_3=$1_2.SetValue('adl.data.1.store','value_3');equals($1_3,'true','adl.data.1.store accepted');$1_2.Terminate('');TestPlayer_LocalStorage.TestUtils.cleanHtml();$1_0=new Player.ContentPlayer(null,this.$1_6,true,false,false);$1_1=$1_0.getActivityTree_V13();equals($1_1.getActiveAPI().getActivityTreeNode().getIdentifier(),'activity_1','* Identify Activity 1 for delivery');$1_2=$1_1.getActiveAPI();ok(!$1_2.isInitAttempted(),'API is not initialized yet, we are using empty page.html file');$1_3=$1_2.Initialize('');equals($1_3,'true','Function must complete successfully');equals($1_2.GetLastError(),'0','LMSInitialize shall set the API Error Code to \'0\' (No error) if it completes successfully');equals($1_2.GetValue('cmi.entry'),'resume','Resume previously visited SCO');$1_3=$1_2.GetValue('adl.data._count');equals($1_3,'2','Correct adl.data._count');$1_3=$1_2.GetValue('adl.data.0.store');equals($1_3,'value_0','Correct adl.data.0.store');$1_3=$1_2.GetValue('adl.data.1.store');equals($1_3,'value_1','Correct adl.data.1.store');$1_2.Terminate('');TestPlayer_LocalStorage.TestUtils.cleanHtml();$1_0=new Player.ContentPlayer(null,this.$1_6,true,false,false);$1_1=$1_0.getActivityTree_V13();equals($1_1.getActiveAPI().getActivityTreeNode().getIdentifier(),'activity_1','* Identify Activity 1 for delivery');$1_2=$1_1.getActiveAPI();ok(!$1_2.isInitAttempted(),'API is not initialized yet, we are using empty page.html file');$1_3=$1_2.Initialize('');equals($1_3,'true','Function must complete successfully');equals($1_2.GetLastError(),'0','LMSInitialize shall set the API Error Code to \'0\' (No error) if it completes successfully');equals($1_2.GetValue('cmi.entry'),'','Previously visited SCO');$1_3=$1_2.GetValue('adl.data._count');equals($1_3,'2','Correct adl.data._count');$1_3=$1_2.GetValue('adl.data.0.store');equals($1_3,'','Correct adl.data.0.store');$1_3=$1_2.GetValue('adl.data.1.store');equals($1_3,'','Correct adl.data.1.store');}));}}
function main(){new TestPlayer_LocalStorage.TestPlayerLocalStorage().run('Test Player with local storage');}
TestPlayer_LocalStorage.TestUtils.createClass('TestPlayer_LocalStorage.TestUtils');TestPlayer_LocalStorage.TestPlayerLocalStorage.createClass('TestPlayer_LocalStorage.TestPlayerLocalStorage',QUnitLibrary.QTest);TestPlayer_LocalStorage.TestPlayerLocalStorage.$1_1='xmlns=\"http://www.imsproject.org/xsd/imscp_rootv1p1p2\"\r\n            xmlns:adlcp=\"http://www.adlnet.org/xsd/adlcp_rootv1p2\"\r\n            xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n            xsi:schemaLocation= \r\n                  \"http://www.imsproject.org/xsd/imscp_rootv1p1p2 \r\n                   imscp_rootv1p1p2.xsd \r\n                   http://www.imsglobal.org/xsd/imsmd_rootv1p2p1\r\n                   imsmd_rootv1p2p1.xsd  \r\n                   http://www.adlnet.org/xsd/adlcp_rootv1p2\r\n                   adlcp_rootv1p2.xsd\"';TestPlayer_LocalStorage.TestPlayerLocalStorage.$1_2='xml:base=\"mycontent\"\r\n            xmlns=\"http://www.imsglobal.org/xsd/imscp_v1p1\"\r\n            xmlns:adlcp=\"http://www.adlnet.org/xsd/adlcp_v1p3\"\r\n            xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n            xsi:schemaLocation=\r\n                \"http://www.imsglobal.org/xsd/imscp_v1p1\r\n                 imscp_v1p1.xsd\r\n                 http://www.adlnet.org/xsd/adlcp_v1p3\r\n                 adlcp_v1p3.xsd\"';TestPlayer_LocalStorage.TestPlayerLocalStorage.$1_3='<?xml version = \"1.0\" standalone = \"no\"?>\r\n                <manifest identifier = \"LMSTestPackage\" version = \"1.0\"\r\n                    xmlns = \"http://www.imsglobal.org/xsd/imscp_v1p1\"\r\n                    xmlns:adlcp = \"http://www.adlnet.org/xsd/adlcp_v1p3\"\r\n                    xmlns:adlseq = \"http://www.adlnet.org/xsd/adlseq_v1p3\"\r\n                    xmlns:adlnav = \"http://www.adlnet.org/xsd/adlnav_v1p3\"\r\n                    xmlns:imsss = \"http://www.imsglobal.org/xsd/imsss\"\r\n                    xmlns:xsi = \"http://www.w3.org/2001/XMLSchema-instance\"\r\n                    xsi:schemaLocation = \"http://www.imsglobal.org/xsd/imscp_v1p1 imscp_v1p1.xsd\r\n                                           http://www.adlnet.org/xsd/adlcp_v1p3 adlcp_v1p3.xsd\r\n                                           http://www.adlnet.org/xsd/adlseq_v1p3 adlseq_v1p3.xsd\r\n                                           http://www.adlnet.org/xsd/adlnav_v1p3 adlnav_v1p3.xsd\r\n                                           http://www.imsglobal.org/xsd/imsss imsss_v1p0.xsd\">\r\n                    <metadata>\r\n                        <schema>ADL SCORM</schema>\r\n                        <schemaversion>2004 4th Edition</schemaversion>\r\n                    </metadata>';
// ---- Do not remove this footer ----
// This script was generated using Script# v0.5.5.0 (http://projects.nikhilk.net/ScriptSharp)
// -----------------------------------
