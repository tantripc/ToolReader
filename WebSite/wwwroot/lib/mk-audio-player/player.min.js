window.addEventListener("load",function(){let n=this.document.getElementById("recoder");n&&$(n).handleRecorder({recoded:function(n){$("#waveformbox").animate({height:"50%"},function(){$("#waverecordbox").show().fadeIn();$("#waverecoder").empty();$("#waverecordbox").handleWave({container:"#waverecoder",waveColor:"blue",progressColor:"red",src:n})})}})}),function(n){n.fn.handleRecorder=function(n){function c(n){var r=Math.ceil(n),t=[],i=Math.floor(r/3600),u=Math.floor((r-i*3600)/60),f=r%60;return t.push(i>=10?i:"0"+i),t.push(u>=10?u:"0"+u),t.push(f>=10?f:"0"+f),t.join(":")}function s(n){t.find(".txt_time").text(c(n))}function f(){u?(t.find(".btn_play,.btn_pause,.btn_stop").css({background:"#f7f9f9",color:"#323232"}),t.find(".btn_delete,.btn_download").show(),t.find("audio").get(0).paused?(t.find(".btn_play").parents("li").first().show(),t.find(".btn_pause").parents("li").first().hide(),t.find(".btn_stop").parents("li").first().hide()):(t.find(".btn_play").parents("li").first().hide(),t.find(".btn_pause").parents("li").first().show(),t.find(".btn_stop").parents("li").first().show())):t.find(".btn_delete,.btn_download").hide();r?(t.find(".btn_play,.btn_pause,.btn_stop").css({background:"#ec6156",color:"#fff"}),t.find(".box_time,.box_action").slideDown()):t.find(".mark_record").hide();u||r?(t.css({background:"rgba(0,0,0,0.1)",opacity:.5}).animate({opacity:1}),s(0,1)):(t.css({background:"transparent"}),t.find(".box_time,.box_action").slideUp());t.css({display:"block"})}n=n||{};let t=this,r=!1,u=!1,i=null,h=0,e=[],o=null;f();t.find(".btn_record").click(function(){u&&(u=!1,t.find("audio").get(0).pause());r?r&&i&&(i&&i.state==="recording"?i.pause():i.state==="paused"&&i.resume()):(r=!1,f(),navigator.mediaDevices?navigator.mediaDevices.getUserMedia({audio:!0},()=>{conosle.log(1)},()=>{conosle.log(0)}).then(u=>{r=!0,f(),i=new MediaRecorder(u),i.addEventListener("dataavailable",n=>{e.push(n.data)}),i.addEventListener("start",()=>{h=0,e=[],t.find(".btn_play").parents("li").first().hide(),t.find(".btn_pause").parents("li").first().show(),t.find(".btn_stop").parents("li").first().show(),t.find(".mark_record").show(),o=setInterval(function(){s(++h,600)},1e3)}),i.addEventListener("pause",()=>{t.find(".btn_play").parents("li").first().show(),t.find(".btn_pause").parents("li").first().hide(),t.find(".btn_stop").parents("li").first().show(),t.find(".mark_record").hide(),clearInterval(o)}),i.addEventListener("resume",()=>{t.find(".btn_play").parents("li").first().hide(),t.find(".btn_pause").parents("li").first().show(),t.find(".btn_stop").parents("li").first().show(),t.find(".mark_record").show(),o=setInterval(function(){s(++h,600)},1e3)}),i.addEventListener("stop",()=>{t.find(".btn_play").parents("li").first().show(),t.find(".btn_pause").parents("li").first().hide(),t.find(".btn_stop").parents("li").first().hide(),clearInterval(o),r=!1,f(),function(i){var r=new Blob(i,{type:"audio/mpeg"}),u=URL.createObjectURL(r),f=new FileReader;f.onload=function(){t.find("audio").prop("src",u);typeof n.recoded=="function"&&n.recoded(u)};f.readAsDataURL(r)}(e)}),i.addEventListener("error",()=>{r=!1,f()}),i.start()}).catch(n=>{console.log(n),alert("Không thể mở Microphone trên thiết bị!"),r=!1,f()}).finally(()=>{}):alert("Không có quyền truy cập thiết bị!"))});t.find(".btn_play").click(function(){r?i&&i.state==="paused"&&i.resume():u&&t.find("audio").get(0).play()});t.find(".btn_pause").click(function(){r?i&&i.state==="recording"&&i.pause():u&&t.find("audio").get(0).pause()});t.find(".btn_stop").click(function(){r?(r=!1,i&&(i.state==="recording"||i.state==="paused")&&i.stop()):u&&(t.find("audio").get(0).pause(),t.find("audio").get(0).currentTime=0)});t.find(".btn_download").click(function(){download(new Blob(e,{type:"audio/mpeg"}),"recorder-audio.mp3","audio/mpeg")});t.find(".btn_delete").click(function(){t.find("audio").removeAttr("src");r=!1;u=!1;f()});t.find("audio").on("waiting",function(){}).on("canplaythrough",function(){}).on("canplay",function(){r=!1;u=!0;f()}).on("durationchange",function(){}).on("timeupdate",function(){s(this.currentTime,this.duration||1)}).on("play",function(){t.find(".btn_play").parents("li").first().hide();t.find(".btn_pause").parents("li").first().show();t.find(".btn_stop").parents("li").first().show()}).on("pause",function(){t.find(".btn_play").parents("li").first().show();t.find(".btn_pause").parents("li").first().hide();t.find(".btn_stop").parents("li").first().show()}).on("ended",function(){t.find(".btn_play").parents("li").first().show();t.find(".btn_pause").parents("li").first().hide();t.find(".btn_stop").parents("li").first().hide()});n.audioSrc&&t.find("audio").prop("src",n.audioSrc).height(30)}}(jQuery);window.addEventListener("load",function(){let n=decodeURIComponent((new RegExp("[?|&]url=([^&;]+?)(&|#|;|$)").exec(location.search)||["",""])[1].replace(/\+/g,"%20"))||null;n&&$("#waveformbox").handleWave({container:"#waveform",waveColor:"#7b92fe",progressColor:"purple",src:n})}),function(n){n.fn.handleWave=function(n){let i=this.get(0),r=i.querySelector(".btn-play"),u=i.querySelector(".btn-pause"),l=i.querySelector(".txt-time"),a=i.querySelector(".txt-duration"),e=function(n){n&&(n.style.display="inline")},o=function(n){n&&(n.style.display="none")},s=function(n,t){n&&(n.textContent=t)},h=function(n){var t=Math.ceil(n),i=[],f=Math.floor(t/3600),r=Math.floor((t-f*3600)/60),u=t%60;return i.push(r>=10?r:"0"+r),i.push(u>=10?u:"0"+u),i.join(":")},f=function(n,t,i){n&&n.addEventListener(t,i)},c=Object.assign({scrollParent:!0,minPxPerSec:1,plugins:[WaveSurfer.cursor.create({showTime:!0,opacity:1,customShowTimeStyle:{"background-color":"#555",color:"#ddd",padding:"2px 5px","font-size":"11px"}})]},n);console.log(JSON.stringify(c,null,2));var t=WaveSurfer.create(c);t.on("audioprocess",function(n){s(l,h(n))});t.on("destroy",function(){});t.on("error",function(){alert("Tập tin âm thanh lỗi")});t.on("finish",function(){});t.on("interaction",function(){});t.on("loading",function(){});t.on("mute",function(){});t.on("pause",function(){o(u);e(r)});t.on("play",function(){o(r);e(u)});t.on("ready",function(){t.play();s(a,h(t.getDuration()))});t.on("scroll",function(){});t.on("seek",function(){});t.on("volume",function(){});t.on("waveform-ready",function(){});t.on("zoom",function(){});t.load(n.src);f(r,"click",function(){t.play()});f(u,"click",function(){t.pause()});f(document.querySelector("#slider"),"input",function(){t.zoom(Number(this.value))})}}(jQuery);